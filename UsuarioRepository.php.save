his class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class UsuarioRepository extends EntityRepository
{
    public function findByTexto($texto)
    {
        $em = $this->getEntityManager();
        $qb = $em->createQueryBuilder()
            ->select('u')
            ->from('AppBundle:Usuario', 'u');

        if (!empty($texto)) {
            $qb->where('u.nombre LIKE :texto OR u.apellido LIKE :texto OR u.usuario LIKE :texto')
               ->setParameter('texto', '%' . $texto . '%');
        }

        $qb->orderBy('u.usuario', 'ASC');

        return $qb->getQuery()->getResult();
    }

    public function checkPermissions($usuario_id, $controller, $action)
    {
        // Verifica si el ID de usuario es válido
        if (empty($usuario_id) || !is_numeric($usuario_id)) {
            return false;
        }

        // Asegura que el controlador y la acción no sean null
        if (empty($controller) || empty($action)) {
            return false;
        }

        // Extrae el nombre puro del controlador sin "Controller"
        $controllerName = str_replace("Controller", "", $controller);

        // Verifica si el usuario tiene permisos en la base de datos
        $em = $this->getEntityManager();
        $query = $em->createQuery("
            SELECT COUNT(u.id) 
            FROM AppBundle:Usuario u 
            WHERE u.id = :usuario_id 
            AND u.activo = 1
        ");
        $query->setParameter('usuario_id', $usuario_id);

        $usuario_activo = $query->getSingleScalarResult();

        if ($usuario_activo == 0) {
            return false; // El usuario está desactivado
        }

        return true; // El usuario tiene permisos
    }
}
